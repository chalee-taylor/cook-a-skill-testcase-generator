# TC_UNSPLASH_F9_SUBSCRIPTION.md â€” Test Cases: Unsplash+ Subscription

**Generated by:** Test Case Generator Skill v1.1.0
**Source Spec:** SPEC_UNSPLASH.md â€” Feature 9
**Feature:** Unsplash+ Subscription
**Coverage Level:** full
**Enable Security:** true
**Generated At:** 2026-02-27
**Output Format:** markdown

---

## Pre-run Report

### Step 0 â€” PII Masking

Scanned spec for PII patterns. Payment card details referenced are synthetic test data only (Stripe test cards). No real PII in spec.

**PII Masking Report:** Fields redacted: 0

---

### Intelligence Scan Report â€” Unsplash+ Subscription

#### Feature Identified
- **Type:** Payment Flow + Subscription Management (via Stripe)
- **Name:** Unsplash+ Subscription
- **Language:** English

#### Business Rules Extracted

Total: **10 rules**

| ID | Rule Summary |
|---|---|
| BR-081 | Unsplash+ is a paid subscription with Monthly or Annual billing |
| BR-082 | Unsplash+ photos identified by lock icon overlay |
| BR-083 | Only active Unsplash+ subscribers can download premium photos without watermark |
| BR-084 | Non-subscriber clicking locked photo is redirected to subscription page |
| BR-085 | Subscription auto-renews at end of each billing cycle unless cancelled |
| BR-086 | Users can cancel any time; access retained until end of current billing period |
| BR-087 | Premium photos not accessible after subscription expires |
| BR-088 | Payment processed via Stripe; raw card data not stored by Unsplash |
| BR-089 | Confirmation email with billing details sent on successful subscription |
| BR-090 | Users can view and download invoices from billing settings |

#### User Flows Detected

Total: **2 flows**

1. Happy Path â€” Subscribe (9 steps)
2. Alternative Flow â€” Cancel Subscription (6 steps)

#### Risk Areas Flagged

| Risk Category | Detected? | Evidence |
|---|---|---|
| Authentication / Auth | **Yes** | Must be Registered User to subscribe |
| Input Validation | **Yes** | Card Luhn check, expiry date, billing address required fields |
| File Upload | No | â€” |
| Payment Processing | **Yes** | Stripe integration, card validation, billing cycle |
| External API / Service | **Yes** | Stripe webhook for subscription activation |
| PII / Sensitive Data | **Yes** | Card details, billing address transmitted to Stripe |
| Rate Limiting | No | â€” |
| Permissions / Roles | **Yes** | Guest must register before subscribing |

#### Spec Quality Assessment
- **Confidence: High**
- Has user flow: Yes
- Has business rules: Yes
- Has validation conditions: Yes
- Missing elements: Stripe webhook delay handling partially described (BR-088 edge case)

#### Coverage Recommendation
- **Recommended: `full`** â€” Payment flow, Stripe integration, subscription state management, and access control are all high-risk

#### Estimated Output
- Estimated TC count: ~25 TCs
- Traceability matrix: included

#### Spec Gaps Detected

| Gap Type | Detected? | Impact |
|---|---|---|
| No failure/error scenarios | No | â€” |
| No boundary conditions in rules | No | â€” |
| Vague expected behavior | Partial | BR-089: "confirmation email with billing details" â€” email content/format not specified |
| External dependency unspecified | Partial | Stripe webhook failure recovery mentioned but behavior on repeated retry not detailed |
| No roles or permissions defined | No | â€” |
| Contradictory rules | No | â€” |
| Only happy path described | No | â€” |

---

## Test Cases â€” Unsplash+ Subscription

### ðŸŸ¢ Happy Path

| ID | Title | Type | Priority | Rule Ref | Precondition | Test Data | Steps | Expected Result |
|---|---|---|---|---|---|---|---|---|
| TC-001 | Registered user subscribes to Monthly plan with valid card | Happy Path | P1 - Critical | BR-081, BR-083, BR-085, BR-088, BR-089 | User subscriber@test.com is logged in with no active subscription. Stripe test mode active. | plan: Monthly / card: 4242424242424242 / expiry: 12/27 / CVV: 123 / billing_name: Test Subscriber / billing_address: 123 Test St, New York, NY 10001 | 1. Click "Get Unsplash+" 2. Select Monthly plan 3. Click "Subscribe" 4. Enter card: 4242424242424242 / expiry: 12/27 / CVV: 123 5. Enter billing name and address 6. Click "Confirm payment" | Subscription activated. User redirected to premium library. Confirmation email sent with billing details. Unsplash+ badge visible on account. Premium photos (lock icon) are now downloadable without watermark. |
| TC-002 | Registered user subscribes to Annual plan with valid card | Happy Path | P1 - Critical | BR-081, BR-083, BR-089 | subscriber@test.com is logged in. No active subscription. | plan: Annual / card: 4242424242424242 / expiry: 12/27 / CVV: 123 | 1. Select Annual plan 2. Enter valid payment details 3. Confirm payment | Annual subscription activated. Confirmation email sent. Access to premium content unlocked. |
| TC-003 | Active subscriber cancels subscription â€” access retained until billing period ends | Happy Path | P1 - Critical | BR-085, BR-086 | subscriber@test.com is logged in with active Monthly subscription. Billing period ends in 10 days. | â€” | 1. Navigate to Account Settings â†’ Billing 2. Click "Cancel subscription" 3. System shows: "Your Unsplash+ access will remain active until [end date]. Are you sure?" 4. Confirm cancellation | Auto-renewal cancelled. User retains access for remaining 10 days. Cancellation confirmation email sent. Subscription status shows "Active until [end date]". |
| TC-004 | Active subscriber downloads PDF invoice from billing settings | Happy Path | P2 - High | BR-090 | subscriber@test.com is logged in with active subscription. At least one billing period has completed. | â€” | 1. Navigate to Account Settings â†’ Billing 2. Find invoice for last billing period 3. Click "Download" | PDF invoice downloaded. Invoice contains billing details (amount, date, plan). |

### ðŸ”´ Negative

| ID | Title | Type | Priority | Rule Ref | Precondition | Test Data | Steps | Expected Result |
|---|---|---|---|---|---|---|---|---|
| TC-005 | Subscription fails when card is declined | Negative | P1 - Critical | BR-081, BR-088 | subscriber@test.com is logged in. No active subscription. | card: 4000000000000002 (Stripe declined card) / expiry: 12/27 / CVV: 123 | 1. Select Monthly plan 2. Enter declined card details 3. Confirm payment | Payment fails. Error: "Payment failed â€” please check your card details". No subscription created. User remains on checkout page. |
| TC-006 | Non-subscriber clicking locked photo is redirected to subscription page | Negative | P1 - Critical | BR-083, BR-084 | user@test.com is logged in. No Unsplash+ subscription. | photo_id: prem001 (premium locked photo) | 1. Log in as user@test.com 2. Click on a photo with lock icon overlay 3. Attempt download | System displays lock icon. User redirected to https://unsplash.com/plus. No download initiated. |
| TC-007 | Guest user cannot access subscription checkout without login | Negative | P1 - Critical | BR-081 | No active session. | â€” | 1. Navigate to https://unsplash.com/plus 2. Click "Subscribe" without logging in | System redirects to /login or /join. Checkout form not displayed without authentication. |
| TC-008 | Subscription with expired card is rejected | Negative | P2 - High | BR-088 | subscriber@test.com is logged in. | card: 4242424242424242 / expiry: 01/20 (past date) / CVV: 123 | 1. Select plan 2. Enter card with past expiry date: 01/20 3. Confirm | Payment rejected. Error: "Your card has expired". No subscription created. |
| TC-009 | Billing address with missing required field blocks subscription | Negative | P2 - High | BR-081 | subscriber@test.com is logged in. | card: valid / billing_address: missing city field | 1. Select plan 2. Enter valid card 3. Leave city field blank in billing address 4. Confirm | Submission blocked. Inline error on the missing field. Subscription not created until all required billing address fields are filled. |
| TC-010 | Premium photo download blocked after subscription expires | Negative | P1 - Critical | BR-083, BR-087 | subscriber@test.com had an active subscription that has now expired. | photo_id: prem001 | 1. Log in as subscriber@test.com (subscription expired) 2. Navigate to premium photo prem001 3. Attempt download | Download gate shown. Lock icon displayed. User redirected to subscription CTA. No watermark-free download. |

### ðŸŸ¡ Edge Cases

| ID | Title | Type | Priority | Rule Ref | Precondition | Test Data | Steps | Expected Result |
|---|---|---|---|---|---|---|---|---|
| TC-011 | Card number fails Luhn check â€” rejected immediately | Edge Case | P1 - Critical | BR-088 | subscriber@test.com is logged in. Checkout page open. | card: 4242424242424243 (invalid Luhn) | 1. Enter card number: 4242424242424243 2. Attempt to confirm | Card rejected by Stripe before charge. Error shown immediately. No payment attempt made to card issuer. |
| TC-012 | User subscribes then immediately cancels â€” access active until billing period end | Edge Case | P2 - High | BR-085, BR-086 | subscriber@test.com just subscribed (Monthly). | â€” | 1. Complete successful subscription 2. Immediately go to Billing Settings 3. Cancel subscription | Cancellation confirmed. Access remains active until end of current billing period. No immediate loss of access. |
| TC-013 | Annual plan subscriber attempts to switch to Monthly mid-cycle | Edge Case | P2 - High | BR-081, BR-085 | subscriber@test.com has active Annual plan. | plan change: Annual â†’ Monthly | 1. Go to Billing Settings 2. Attempt to change plan from Annual to Monthly | Plan change is applied at next billing cycle, not immediately. Current Annual access continues. Confirmation shown with next billing date. |
| TC-014 | Subscription expires while user is mid-download of premium photo | Edge Case | P1 - Critical | BR-086, BR-087 | subscriber@test.com. Subscription expires in 2 seconds. Premium photo download in progress. | â€” | 1. Start download of premium photo 2. Subscription expires during download | Current in-progress download is allowed to complete. Next premium download attempt shows subscription gate (BR-087 enforced on next request). |
| TC-015 | Stripe webhook delayed â€” subscription activation retried until confirmed | Edge Case | P2 - High | BR-088 | subscriber@test.com completes payment. Stripe webhook is delayed. | â€” | 1. Complete valid payment checkout 2. Observe if Unsplash+ access is delayed due to webhook | System retries webhook processing. Once confirmed, access is granted. User not permanently locked out due to transient webhook delay. |
| TC-016 | Invoice PDF for zero-charge period shows $0.00 | Edge Case | P3 - Medium | BR-090 | subscriber@test.com has a trial or promotional period with $0.00 charge. | â€” | 1. Go to Billing Settings 2. Download invoice for trial/promo period | Invoice PDF downloads. Amount shown: $0.00. Invoice is valid and not empty. |
| TC-017 | Subscription auto-renews at end of billing cycle | Edge Case | P1 - Critical | BR-085 | subscriber@test.com has active Monthly subscription. Billing date is reached. Card on file is valid. | â€” | 1. Wait for billing cycle to end (or simulate in test environment) 2. Check subscription status and billing history | Subscription auto-renewed. New invoice generated. Access continues without interruption. User notified via email of renewal. |

### ðŸ”’ Security

| ID | Title | Type | Priority | Rule Ref | Precondition | Test Data | Steps | Expected Result |
|---|---|---|---|---|---|---|---|---|
| TC-018 | Raw card data is not stored by Unsplash (Stripe tokenization) | Security | P1 - Critical | BR-088 | subscriber@test.com is logged in. DevTools Network tab open. | card: 4242424242424242 / expiry: 12/27 / CVV: 123 | 1. Open DevTools â†’ Network tab 2. Enter card details in checkout 3. Confirm payment 4. Inspect all network requests | Card number and CVV are NOT sent in any request to Unsplash servers. Stripe.js tokenizes the card client-side. Only a Stripe payment token (pm_xxx) is sent to Unsplash backend. No raw card data in request payloads or server logs. |
| TC-019 | Subscription state cannot be activated without valid Stripe payment | Security | P1 - Critical | BR-081, BR-088 | attacker@test.com is logged in. No subscription. | Modify API response to simulate success / forge subscription token | 1. Intercept payment flow 2. Attempt to modify the Stripe checkout response to indicate success without actual payment 3. Check subscription status | Subscription is NOT activated. Unsplash validates subscription status via server-side Stripe API call, not client-side response alone. No fraudulent activation possible. |
| TC-020 | IDOR â€” user cannot access another subscriber's invoices | Security | P1 - Critical | BR-090 | attacker@test.com is logged in. victim@test.com has invoices. | invoice_id: victim's invoice ID | 1. Log in as attacker@test.com 2. Attempt to access billing invoice URL with victim@test.com's invoice ID | Server returns 403 Forbidden. Attacker cannot view or download victim's invoices. Access restricted to account owner. |
| TC-021 | Subscription endpoint requires authentication â€” unauthenticated requests rejected | Security | P1 - Critical | BR-081 | No active session. | POST to subscription create endpoint without auth token | 1. Send POST request to subscription endpoint without auth | Server returns 401 Unauthorized. Subscription not created. |
| TC-022 | Cancelled subscription state cannot be reversed by replay attack | Security | P2 - High | BR-086 | subscriber@test.com has cancelled subscription. | Replay original subscription activation request | 1. After cancellation, capture and replay the original subscription creation request | Server returns 400/409 or ignores the replayed request. Subscription state remains "Cancelled". |
| TC-023 | Sensitive payment data not exposed in browser history or URL | Security | P2 - High | BR-088 | subscriber@test.com is going through checkout. | card: 4242424242424242 | 1. Complete checkout 2. Check browser address bar and history during and after checkout | Card number, CVV, and expiry are NOT present in any URL (query params or path). Checkout uses POST over HTTPS. No sensitive data in browser history. |

---

## Traceability Matrix

| Rule ID | Rule Description | Covered By | Status |
|---|---|---|---|
| BR-081 | Monthly or Annual billing | TC-001, TC-002, TC-007, TC-009, TC-013, TC-021 | âœ… Covered |
| BR-082 | Lock icon on premium photos | TC-006 | âœ… Covered |
| BR-083 | Only active subscriber downloads premium | TC-001, TC-006, TC-010, TC-019 | âœ… Covered |
| BR-084 | Non-subscriber redirected to subscription page | TC-006 | âœ… Covered |
| BR-085 | Auto-renewal unless cancelled | TC-003, TC-012, TC-013, TC-017 | âœ… Covered |
| BR-086 | Cancel any time; access until billing period end | TC-003, TC-012, TC-014, TC-022 | âœ… Covered |
| BR-087 | No premium access after expiry | TC-010, TC-014 | âœ… Covered |
| BR-088 | Payment via Stripe; no raw card data stored | TC-001, TC-005, TC-008, TC-011, TC-018, TC-019, TC-023 | âœ… Covered |
| BR-089 | Confirmation email on subscription | TC-001, TC-002 | âœ… Covered |
| BR-090 | Invoices viewable and downloadable | TC-004, TC-016, TC-020 | âœ… Covered |

---

## Coverage Summary

| Type | Count |
|---|---|
| ðŸŸ¢ Happy Path | 4 |
| ðŸ”´ Negative | 6 |
| ðŸŸ¡ Edge Case | 7 |
| ðŸ”’ Security | 6 |
| **Total** | **23** |

**Rule Coverage:** 10 / 10 rules = **100%**

---

## Test Execution Report

```
Feature:      Unsplash+ Subscription
Source Spec:  SPEC_UNSPLASH.md â€” Feature 9
Tester:       ___________
Date:         ___________
Environment:  ___________
Build/Version:___________

| Total TCs | Pass | Fail | Blocked | Not Run |
|-----------|------|------|---------|---------|
|    23     |      |      |         |         |

Defects Found:
| Bug ID | TC ID | Rule Ref | Description | Severity | Status |
|--------|-------|----------|-------------|----------|--------|
|        |       |          |             |          |        |

Sign-off:
[ ] QC Lead Review: ___________
[ ] Security Review (if applicable): ___________
[ ] Ready for Release
```
