# Test Cases â€” Feature 6: Collections Management
**Feature:** Collections Management
**Spec Source:** SPEC_UNSPLASH.md â€” Section 6
**Generated By:** testcase-generator v1.1.0
**Coverage Level:** full
**Security Enabled:** true
**PII Masking:** true
**Generated At:** 2026-02-26

---

## Pre-Run Report

### PII Masking Report

| Pattern Scanned | Occurrences Found | Masked |
|---|---|---|
| Email addresses | 0 | 0 |
| Phone numbers | 0 | 0 |
| API keys / tokens (â‰¥ 20 alphanumeric chars) | 0 | 0 |
| JWT tokens (`eyJâ€¦`) | 0 | 0 |
| National IDs (9 or 12 digits) | 0 | 0 |
| Credit card numbers (13â€“19 digits) | 0 | 0 |
| IP addresses | 0 | 0 |
| Internal URLs | 0 | 0 |

**Result:** No PII patterns detected in the spec. Processing continues with original content.

---

## Intelligence Scan Report â€” Collections Management

### Feature Identified
- **Type:** Web Form + Auth Flow
- **Name:** Collections Management
- **Language:** English

---

### Business Rules Extracted

Total: 12 rules

| ID | Rule Summary | Source |
|---|---|---|
| BR-049 | Only authenticated users can create collections | Business Rules section |
| BR-050 | A user can create an unlimited number of collections | Business Rules section |
| BR-051 | Collection names must be between 1 and 60 characters | Business Rules section |
| BR-052 | Collections can be Public (visible to all) or Private (visible only to owner) | Business Rules section |
| BR-053 | Users can add any photo (free or Unsplash+) to collections without a subscription | Business Rules section |
| BR-054 | A user cannot add the same photo to the same collection twice (duplicate prevention) | Business Rules section |
| BR-055 | The photo contributor receives a notification when their photo is added to a collection | Business Rules section |
| BR-056 | Collections with offensive content are removed by admins; email sent to creator | Business Rules section |
| BR-057 | Users can delete their collections â€” deleting does not delete the photos | Business Rules section |
| BR-058 | Users can reorder photos within a collection | Business Rules section |
| BR-059 | Collection displays a cover photo (default: first photo added; user can change) | Business Rules section |
| BR-060 | Other users can follow public collections to receive updates | Business Rules section |

---

### User Flows Detected

Total: 3 flows

1. **Happy Path â€” Create a New Collection** â€” 8 steps
2. **Happy Path â€” Add Photo to Existing Collection** â€” 5 steps
3. **Alternative Flow â€” Delete a Collection** â€” 6 steps

---

### Risk Areas Flagged

| Risk Category | Detected? | Evidence in Spec |
|---|---|---|
| Authentication / Auth | Yes | "Only authenticated users can create collections" (BR-049); "Guest tries to collect a photo â†’ Login/signup prompt" |
| Input Validation | Yes | Collection name: 1â€“60 characters; cannot be whitespace-only (BR-051) |
| File Upload | No | No file upload in this feature |
| Payment Processing | No | "without a subscription" mentioned but no payment flow |
| External API / Service | Yes | Contributor notification system (BR-055); admin moderation (BR-056) |
| PII / Sensitive Data | No | No PII fields in collection create/add forms |
| Rate Limiting | No | Not explicitly specified in the spec |
| Permissions / Roles | Yes | Registered User vs. Guest distinction; collection ownership for IDOR risk |

---

### Spec Quality Assessment

- **Confidence:** High
- **Has user flow:** Yes (3 flows, 8+5+6 steps)
- **Has business rules:** Yes (12 rules, BR-049 to BR-060)
- **Has validation conditions:** Yes (name length, whitespace-only, duplicate photo, visibility enum)
- **Missing elements:** Notification delivery mechanism not specified (BR-055 / BR-056); rate limiting for collection creation not defined; HTTP endpoints not listed

---

### Coverage Recommendation

- **Recommended coverage_level:** full
- **Reason:** 12 business rules with auth/permission risk, IDOR risk (collection_id ownership), input validation boundaries, concurrent state issues, and a multi-step delete flow all warrant full coverage including security cases.

---

### Estimated Output

- **Estimated TC count:** ~72 (12 rules Ã— 6 full-coverage multiplier)
- **Traceability matrix:** Included
- **Large Output Rule:** TC count exceeds 50 â€” output organized by User Flow with type sub-sections

> Note: Total TC count after deduplication and merging of related scenarios is 52.

---

### Spec Gaps Detected

| Gap Type | Detected? | Impact on TC Generation |
|---|---|---|
| No failure / error scenarios | No | Failure scenarios are described in the Output table |
| No boundary conditions in rules | No | Min/max defined in BR-051 and Edge Cases table |
| Vague expected behavior | Partial | BR-055 notification and BR-056 email do not specify message content; affected TCs will have [VERIFY] markers |
| External dependency unspecified | Yes | Notification delivery (BR-055, BR-056): system behavior on notification failure not described |
| No roles or permissions defined | No | Registered User vs. Guest roles are defined |
| Contradictory rules detected | No | No contradictions found |
| Only happy path described | No | Alternative and error flows are described |

---

Proceeding to test case generation...

---

## Test Cases â€” Collections Management

> **Large Output Rule applied.** Total TC count exceeds 50. Test cases are grouped by User Flow. Type sub-sections (Happy Path, Negative, Edge Case, Security) appear within each flow group.

---

### Flow 1 â€” Create a New Collection

#### ðŸŸ¢ Happy Path

---

**TC-001**

| Field | Value |
|---|---|
| **ID** | TC-001 |
| **Title** | Create a new public collection with a valid name (no initial photo) |
| **Type** | Happy Path |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049, BR-051, BR-052 |
| **Precondition** | User is authenticated as `registered_user_01`. The photo detail page for photo ID `abc123xyz` is open. |
| **Test Data** | `collection_name: "Nature Escapes"` / `visibility: Public` / `photo_id: (none)` |
| **Steps** | 1. Navigate to any photo detail page while logged in as `registered_user_01`. 2. Click the "Collect" (bookmark) icon on the photo. 3. Observe the dropdown that appears. 4. Click "Create new collection". 5. Enter collection name: `Nature Escapes`. 6. Select visibility: `Public`. 7. Leave the first-photo field blank. 8. Click "Create". |
| **Expected Result** | New collection "Nature Escapes" is created. System redirects to or displays the collection page. The collection appears in the user's Collections tab on their profile. No photo is shown in the collection. Success state is visible (no error messages). |
| **Actual Result** | |
| **Status** | |
| **Notes** | Covers core creation flow without optional photo_id. |

---

**TC-002**

| Field | Value |
|---|---|
| **ID** | TC-002 |
| **Title** | Create a new collection and add the current photo as the first photo |
| **Type** | Happy Path |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049, BR-051, BR-052, BR-059 |
| **Precondition** | User is authenticated as `registered_user_01`. The photo detail page for photo ID `photo_001` is open. |
| **Test Data** | `collection_name: "City Architecture"` / `visibility: Public` / `photo_id: photo_001` |
| **Steps** | 1. Navigate to the detail page of photo ID `photo_001` while logged in as `registered_user_01`. 2. Click the "Collect" icon. 3. Click "Create new collection" in the dropdown. 4. Enter collection name: `City Architecture`. 5. Select visibility: `Public`. 6. Confirm `photo_001` is pre-selected or check the option to add the current photo. 7. Click "Create". |
| **Expected Result** | Collection "City Architecture" is created. The system displays: `"Photo added to City Architecture"`. The photo `photo_001` appears in the collection. The collection's cover photo is set to `photo_001` (default first photo per BR-059). |
| **Actual Result** | |
| **Status** | |
| **Notes** | Verifies BR-059 cover photo default behavior. |

---

**TC-003**

| Field | Value |
|---|---|
| **ID** | TC-003 |
| **Title** | Create a new private collection successfully |
| **Type** | Happy Path |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049, BR-051, BR-052 |
| **Precondition** | User is authenticated as `registered_user_01`. |
| **Test Data** | `collection_name: "Private Favorites"` / `visibility: Private` |
| **Steps** | 1. Navigate to any photo detail page while logged in as `registered_user_01`. 2. Click the "Collect" icon. 3. Click "Create new collection". 4. Enter collection name: `Private Favorites`. 5. Select visibility: `Private`. 6. Click "Create". |
| **Expected Result** | Collection "Private Favorites" is created with Private visibility. The collection appears in `registered_user_01`'s Collections tab. The collection is NOT visible in public search or to other users. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Verifies Private visibility enforcement per BR-052. |

---

**TC-004**

| Field | Value |
|---|---|
| **ID** | TC-004 |
| **Title** | Authenticated user can create multiple collections (unlimited) |
| **Type** | Happy Path |
| **Priority** | P2 - High |
| **Rule Ref** | BR-050 |
| **Precondition** | User `registered_user_01` already has 5 existing collections. |
| **Test Data** | `collection_name: "Collection Six"` / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01` who already has 5 collections. 2. Navigate to any photo detail page. 3. Click the "Collect" icon. 4. Click "Create new collection". 5. Enter collection name: `Collection Six`. 6. Select visibility: `Public`. 7. Click "Create". |
| **Expected Result** | The 6th collection "Collection Six" is created successfully. No error about collection limit is shown. The user now has 6 collections in their Collections tab. |
| **Actual Result** | |
| **Status** | |
| **Notes** | BR-050 explicitly states unlimited collections are allowed. |

---

#### ðŸ”´ Negative

---

**TC-005**

| Field | Value |
|---|---|
| **ID** | TC-005 |
| **Title** | Guest user cannot create a collection â€” login prompt shown |
| **Type** | Negative |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049 |
| **Precondition** | No user is logged in (anonymous/guest session). A photo detail page is open. |
| **Test Data** | User session: guest (unauthenticated) |
| **Steps** | 1. Open a photo detail page without logging in. 2. Click the "Collect" (bookmark) icon on the photo. |
| **Expected Result** | System does NOT open the collection dropdown. Instead, a login/signup prompt is displayed with the message: `"Sign up to collect photos"`. The user remains unauthenticated. No collection is created. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Core auth gate per BR-049. |

---

**TC-006**

| Field | Value |
|---|---|
| **ID** | TC-006 |
| **Title** | Collection creation rejected when name is empty |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: ""` (empty string) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Leave the collection name field completely empty. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Collection is NOT created. System displays an inline validation error: `"Collection name is required"` (or equivalent). The dialog remains open. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

**TC-007**

| Field | Value |
|---|---|
| **ID** | TC-007 |
| **Title** | Collection creation rejected when name is whitespace-only |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "   "` (3 space characters) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter exactly 3 space characters in the collection name field: press Space three times. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Collection is NOT created. System displays an inline validation error: `"Collection name cannot be empty or whitespace-only"` (or equivalent). The dialog remains open. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Whitespace-only check is explicitly called out in spec Edge Cases table. |

---

**TC-008**

| Field | Value |
|---|---|
| **ID** | TC-008 |
| **Title** | Collection creation rejected when name exceeds 60 characters |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "A"` Ã— 61 = `"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"` (61 A's) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter 61 characters in the collection name field: type 61 consecutive letter A's. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Collection is NOT created. System displays: `"Collection name cannot exceed 60 characters"`. The dialog remains open. The name field may truncate to 60 characters or show character count feedback. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

**TC-009**

| Field | Value |
|---|---|
| **ID** | TC-009 |
| **Title** | Collection visibility is required â€” cannot create without selecting Public or Private |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-052 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. Visibility field has no default pre-selected. |
| **Test Data** | `collection_name: "My Test Collection"` / `visibility: (none selected)` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter collection name: `My Test Collection`. 5. Do NOT select any visibility option (leave blank or deselect). 6. Click "Create". |
| **Expected Result** | Collection is NOT created. System displays a validation error indicating that visibility is required. If the UI always pre-selects a default visibility, this TC can be recorded as N/A with a note. |
| **Actual Result** | |
| **Status** | |
| **Notes** | If the UI enforces a default selection for visibility, update this TC accordingly. |

---

#### ðŸŸ¡ Edge Cases

---

**TC-010**

| Field | Value |
|---|---|
| **ID** | TC-010 |
| **Title** | Collection name at minimum boundary (exactly 1 character) is accepted |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "A"` (1 character) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter exactly 1 character in the collection name field: type `A`. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Collection named `A` is created successfully. No validation error is shown. The collection appears in `registered_user_01`'s Collections tab. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Boundary value: minimum valid length. |

---

**TC-011**

| Field | Value |
|---|---|
| **ID** | TC-011 |
| **Title** | Collection name at maximum boundary (exactly 60 characters) is accepted |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "AbcdefghijAbcdefghijAbcdefghijAbcdefghijAbcdefghijAbcdefghij"` (exactly 60 chars) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter exactly 60 characters in the collection name field: `AbcdefghijAbcdefghijAbcdefghijAbcdefghijAbcdefghijAbcdefghij`. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Collection is created successfully. The collection name is stored and displayed in full as the 60-character string. No error is shown. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Boundary value: maximum valid length. |

---

**TC-012**

| Field | Value |
|---|---|
| **ID** | TC-012 |
| **Title** | Collection name with leading/trailing whitespace is trimmed or rejected |
| **Type** | Edge Case |
| **Priority** | P3 - Medium |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "  Summer Vibes  "` (2 leading + 2 trailing spaces, 14 total chars) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter `  Summer Vibes  ` (with 2 leading and 2 trailing spaces) in the name field. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Either: (a) System trims the whitespace and creates the collection with name `Summer Vibes`, OR (b) System rejects the input as whitespace-only if the entire boundary check treats leading/trailing spaces as invalid. The collection name stored and displayed should be `Summer Vibes` without extra spaces. No silent save of `  Summer Vibes  ` with leading/trailing spaces. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Trimming behavior is not explicitly specified in the spec. [VERIFY: confirm whether the system trims or rejects leading/trailing whitespace.] |

---

**TC-013**

| Field | Value |
|---|---|
| **ID** | TC-013 |
| **Title** | Collection name with special characters is accepted |
| **Type** | Edge Case |
| **Priority** | P3 - Medium |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "Art & Design: 2026!"` (20 chars, includes & : !) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter collection name: `Art & Design: 2026!`. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Collection is created and its name is stored and displayed exactly as `Art & Design: 2026!`. No encoding errors or character stripping occurs. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Spec does not restrict special characters in collection names. |

---

**TC-014**

| Field | Value |
|---|---|
| **ID** | TC-014 |
| **Title** | Collection name with Unicode characters (non-ASCII) is accepted |
| **Type** | Edge Case |
| **Priority** | P3 - Medium |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "HÃ  Ná»™i Streets"` (14 chars, contains Vietnamese Unicode) / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter collection name: `HÃ  Ná»™i Streets`. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | Collection is created and its name is stored and displayed exactly as `HÃ  Ná»™i Streets` without corruption, question marks, or encoding errors. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Unicode support is not explicitly mentioned in the spec but is expected for a global platform. |

---

**TC-015**

| Field | Value |
|---|---|
| **ID** | TC-015 |
| **Title** | Session expires during collection creation â€” action fails gracefully |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-049 |
| **Precondition** | User `registered_user_01` is on the "Create new collection" dialog. The session token has just expired (simulate by invalidating the session server-side or waiting for expiry). |
| **Test Data** | `collection_name: "Expired Session Test"` / `visibility: Public` / session: expired |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and open the "Create new collection" dialog. 3. Enter collection name: `Expired Session Test` and select `Public`. 4. Invalidate the session server-side (e.g., force logout from another tab). 5. Click "Create". |
| **Expected Result** | System does NOT create the collection. User is redirected to the login page or shown an authentication error (e.g., `"Your session has expired. Please log in again."`). No orphaned collection is saved. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Session expiry mid-flow is a critical security-adjacent edge case. |

---

**TC-016**

| Field | Value |
|---|---|
| **ID** | TC-016 |
| **Title** | Double-submit of collection creation form does not create duplicate collections |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "Double Submit Test"` / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter collection name: `Double Submit Test`. 5. Select visibility: `Public`. 6. Double-click the "Create" button rapidly (or click it twice within 500ms). |
| **Expected Result** | Exactly one collection named `Double Submit Test` is created. No duplicate collection with the same name is created for the same user. The "Create" button is disabled after the first click to prevent double-submission. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Double-submission guard is not explicitly specified; [VERIFY: confirm deduplication behavior in the backend.] |

---

#### ðŸ”’ Security

---

**TC-017**

| Field | Value |
|---|---|
| **ID** | TC-017 |
| **Title** | SQL injection in collection name field does not cause database errors |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. "Create new collection" dialog is open. |
| **Test Data** | `collection_name: "' OR '1'='1'--"` / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter in the collection name field: `' OR '1'='1'--`. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | System either: (a) rejects the input as containing invalid characters and displays a validation error, OR (b) safely stores the literal string `' OR '1'='1'--` as the collection name without executing any SQL. No SQL error, database dump, or stack trace is visible in the UI or HTTP response. Request is logged as suspicious. |
| **Actual Result** | |
| **Status** | |
| **Notes** | SQL injection via collection name input. |

---

**TC-018**

| Field | Value |
|---|---|
| **ID** | TC-018 |
| **Title** | XSS in collection name field does not execute script when collection is displayed |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-051, BR-052, BR-060 |
| **Precondition** | User is authenticated as `registered_user_01`. A second user `registered_user_02` exists. |
| **Test Data** | `collection_name: "<script>alert('XSS')</script>"` / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Enter in the collection name field: `<script>alert('XSS')</script>`. 5. Select visibility: `Public`. 6. Click "Create". 7. Log out and log in as `registered_user_02`. 8. Navigate to the collection page or profile of `registered_user_01` where the collection is listed. |
| **Expected Result** | No JavaScript alert dialog appears. The collection name is displayed as the escaped literal text `&lt;script&gt;alert('XSS')&lt;/script&gt;` or the input is rejected at creation. No script executes in any user's browser. |
| **Actual Result** | |
| **Status** | |
| **Notes** | XSS risk because collection names are displayed to other users viewing public collections (BR-052, BR-060). |

---

**TC-019**

| Field | Value |
|---|---|
| **ID** | TC-019 |
| **Title** | Unauthenticated POST request to create-collection endpoint is rejected |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049 |
| **Precondition** | No active authenticated session. Collection creation API endpoint is accessible. |
| **Test Data** | Request body: `{"name": "Hacked Collection", "visibility": "Public"}` / Authorization header: absent or empty |
| **Steps** | 1. Open a browser developer console or use an API tool (e.g., curl). 2. Send a POST request directly to the collection creation endpoint (e.g., `/api/collections`) with body: `{"name": "Hacked Collection", "visibility": "Public"}`. 3. Include no Authorization header or Bearer token. 4. Observe the HTTP response. |
| **Expected Result** | Server returns HTTP `401 Unauthorized`. Response body contains an error message (e.g., `{"error": "Authentication required"}`). No collection is created in the database. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Direct API bypass attempt for BR-049 auth gate. |

---

**TC-020**

| Field | Value |
|---|---|
| **ID** | TC-020 |
| **Title** | IDOR: User cannot create a collection on behalf of another user by forging the owner ID |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049 |
| **Precondition** | `registered_user_01` is authenticated. `registered_user_02` exists with user ID `user_id_002`. |
| **Test Data** | Request body: `{"name": "Forged Collection", "visibility": "Public", "user_id": "user_id_002"}` / Authorization: token for `registered_user_01` |
| **Steps** | 1. Log in as `registered_user_01` and obtain their auth token. 2. Send a POST request to the collection creation endpoint with the auth token for `registered_user_01` but include `"user_id": "user_id_002"` in the request body. 3. Observe the HTTP response and check the owner of any created collection. |
| **Expected Result** | Server ignores the forged `user_id` field and either: (a) creates the collection under `registered_user_01`'s account, OR (b) returns HTTP `403 Forbidden`. The collection does NOT appear under `registered_user_02`'s account. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Mass assignment / IDOR risk via forged owner ID in API body. |

---

**TC-021**

| Field | Value |
|---|---|
| **ID** | TC-021 |
| **Title** | CSRF: State-changing collection creation request requires valid CSRF token |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049 |
| **Precondition** | `registered_user_01` is authenticated in a browser session. |
| **Test Data** | Forged cross-origin POST request to the collection creation endpoint without CSRF token |
| **Steps** | 1. Log in as `registered_user_01` in Browser A. 2. From Browser B or a separate origin (e.g., a local HTML file), craft a form POST to the collection creation endpoint without a valid CSRF token. 3. Include valid session cookies for `registered_user_01` (if accessible â€” this simulates a CSRF attack scenario). 4. Submit the forged request. |
| **Expected Result** | Server rejects the request with HTTP `403 Forbidden` or `Invalid CSRF token` error. No collection is created. |
| **Actual Result** | |
| **Status** | |
| **Notes** | CSRF protection on all state-changing POST endpoints. |

---

**TC-022**

| Field | Value |
|---|---|
| **ID** | TC-022 |
| **Title** | Very long collection name (1000 chars) does not cause server error or buffer overflow |
| **Type** | Security |
| **Priority** | P2 - High |
| **Rule Ref** | BR-051 |
| **Precondition** | User is authenticated as `registered_user_01`. |
| **Test Data** | `collection_name:` string of 1000 letter A's / `visibility: Public` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to a photo detail page and click "Collect". 3. Click "Create new collection". 4. Paste a string of 1000 letter A's into the collection name field. 5. Select visibility: `Public`. 6. Click "Create". |
| **Expected Result** | System returns a validation error: `"Collection name cannot exceed 60 characters"`. No server-side error (HTTP 500) occurs. The server does not crash or expose a stack trace. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Long input stress test â€” server-side validation must enforce the 60-char limit. |

---

### Flow 2 â€” Add Photo to Existing Collection

#### ðŸŸ¢ Happy Path

---

**TC-023**

| Field | Value |
|---|---|
| **ID** | TC-023 |
| **Title** | Authenticated user adds a photo to an existing collection successfully |
| **Type** | Happy Path |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049, BR-053, BR-055 |
| **Precondition** | `registered_user_01` is authenticated and has an existing collection `collection_id_A` named "Urban Life" that does NOT yet contain photo `photo_002`. Photo contributor `contributor_user_01` owns photo `photo_002`. |
| **Test Data** | `photo_id: photo_002` / `collection_id: collection_id_A` ("Urban Life") |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to the detail page of photo `photo_002`. 3. Click the "Collect" icon. 4. Observe the dropdown list of collections. 5. Confirm that "Urban Life" appears in the list WITHOUT a checkmark. 6. Click on "Urban Life". |
| **Expected Result** | Photo `photo_002` is added to collection "Urban Life". A checkmark appears on "Urban Life" in the dropdown. The system displays: `"Photo added to Urban Life"` (or checkmark confirmation). Contributor `contributor_user_01` receives a notification that their photo was added to a collection. [VERIFY: confirm exact notification message and delivery channel per BR-055.] |
| **Actual Result** | |
| **Status** | |
| **Notes** | Notification delivery mechanism not specified in spec â€” [NOT SPECIFIED: add expected notification content and delivery channel to spec for BR-055.] |

---

**TC-024**

| Field | Value |
|---|---|
| **ID** | TC-024 |
| **Title** | Collections dropdown shows checkmark on collections already containing the photo |
| **Type** | Happy Path |
| **Priority** | P2 - High |
| **Rule Ref** | BR-054 |
| **Precondition** | `registered_user_01` is authenticated and has collection `collection_id_A` ("Urban Life") that ALREADY contains photo `photo_003`. User also has collection `collection_id_B` ("Nature") that does NOT contain photo `photo_003`. |
| **Test Data** | `photo_id: photo_003` / collections: "Urban Life" (contains photo_003), "Nature" (does not contain photo_003) |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to the detail page of photo `photo_003`. 3. Click the "Collect" icon. 4. Observe the dropdown list of collections. |
| **Expected Result** | "Urban Life" displays a checkmark indicator next to its name (photo already in this collection). "Nature" displays no checkmark (photo not in this collection). Both collections are listed. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Verifies the dropdown UI state per the "Add Photo to Existing Collection" happy path flow step 3. |

---

**TC-025**

| Field | Value |
|---|---|
| **ID** | TC-025 |
| **Title** | Free photo (non-Unsplash+) can be added to a collection without subscription |
| **Type** | Happy Path |
| **Priority** | P2 - High |
| **Rule Ref** | BR-053 |
| **Precondition** | `registered_user_01` is authenticated with a free (non-Unsplash+) account. Photo `photo_free_001` is a free-tier photo. Collection `collection_id_A` exists and does not contain `photo_free_001`. |
| **Test Data** | `photo_id: photo_free_001` (free tier) / `collection_id: collection_id_A` / user subscription: free |
| **Steps** | 1. Log in as `registered_user_01` (free account, no Unsplash+ subscription). 2. Navigate to the detail page of free photo `photo_free_001`. 3. Click the "Collect" icon. 4. Click on collection `collection_id_A` in the dropdown. |
| **Expected Result** | Photo `photo_free_001` is added to `collection_id_A` successfully. No subscription prompt or paywall is shown. The checkmark appears on the collection. |
| **Actual Result** | |
| **Status** | |
| **Notes** | BR-053 explicitly states no subscription is required to collect photos. |

---

#### ðŸ”´ Negative

---

**TC-026**

| Field | Value |
|---|---|
| **ID** | TC-026 |
| **Title** | Adding the same photo to the same collection twice is silently prevented |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-054 |
| **Precondition** | `registered_user_01` is authenticated. Collection `collection_id_A` ("Urban Life") already contains photo `photo_003`. |
| **Test Data** | `photo_id: photo_003` / `collection_id: collection_id_A` ("Urban Life") (photo already present) |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to the detail page of photo `photo_003`. 3. Click the "Collect" icon. 4. In the dropdown, click on "Urban Life" (which already has a checkmark indicating the photo is present). |
| **Expected Result** | System displays: `"Already in this collection"`. No duplicate entry for `photo_003` is created in "Urban Life". The photo count in the collection does not increase. The checkmark remains on "Urban Life". |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

**TC-027**

| Field | Value |
|---|---|
| **ID** | TC-027 |
| **Title** | Adding a photo to a non-existent collection ID is rejected |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-049 |
| **Precondition** | `registered_user_01` is authenticated. Collection ID `collection_id_INVALID` does not exist in the database. |
| **Test Data** | `photo_id: photo_002` / `collection_id: collection_id_INVALID` (non-existent) |
| **Steps** | 1. Log in as `registered_user_01` and obtain their auth token. 2. Send a POST request to the add-photo-to-collection endpoint with `photo_id: photo_002` and `collection_id: collection_id_INVALID`. 3. Observe the HTTP response. |
| **Expected Result** | Server returns HTTP `404 Not Found` or `400 Bad Request`. Response body contains an appropriate error message. No data is modified in the database. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Direct API test for invalid collection reference. |

---

**TC-028**

| Field | Value |
|---|---|
| **ID** | TC-028 |
| **Title** | Adding a photo using an invalid photo ID is rejected |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-053 |
| **Precondition** | `registered_user_01` is authenticated. Collection `collection_id_A` exists. Photo ID `photo_INVALID_999` does not exist. |
| **Test Data** | `photo_id: photo_INVALID_999` (non-existent) / `collection_id: collection_id_A` |
| **Steps** | 1. Log in as `registered_user_01` and obtain their auth token. 2. Send a POST request to the add-photo endpoint with `photo_id: photo_INVALID_999` and `collection_id: collection_id_A`. 3. Observe the HTTP response. |
| **Expected Result** | Server returns HTTP `404 Not Found` or `400 Bad Request`. An error message is returned (e.g., `"Photo not found"`). No entry is added to collection `collection_id_A`. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

#### ðŸŸ¡ Edge Cases

---

**TC-029**

| Field | Value |
|---|---|
| **ID** | TC-029 |
| **Title** | User follows a public collection and it appears in their following list |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-060 |
| **Precondition** | `registered_user_01` has a public collection `collection_id_A` ("Urban Life"). `registered_user_02` is authenticated and not yet following this collection. |
| **Test Data** | `collection_id: collection_id_A` (public) / follower: `registered_user_02` |
| **Steps** | 1. Log in as `registered_user_02`. 2. Navigate to `registered_user_01`'s public collection "Urban Life". 3. Click the "Follow" button on the collection. |
| **Expected Result** | `registered_user_02` is now following "Urban Life". The collection appears in `registered_user_02`'s following list. The follow button changes state to "Unfollow" or equivalent. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

**TC-030**

| Field | Value |
|---|---|
| **ID** | TC-030 |
| **Title** | User cannot follow a private collection |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-052, BR-060 |
| **Precondition** | `registered_user_01` has a private collection `collection_id_B` ("Private Favorites"). `registered_user_02` is authenticated. |
| **Test Data** | `collection_id: collection_id_B` (private) / user: `registered_user_02` |
| **Steps** | 1. Log in as `registered_user_02`. 2. Attempt to navigate to the URL of `collection_id_B` (private collection owned by `registered_user_01`). 3. If accessible, attempt to click "Follow". |
| **Expected Result** | `registered_user_02` receives a 404 or "Access Denied" response when attempting to access the private collection URL. No "Follow" button is visible. `registered_user_02` cannot follow the collection. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Combines BR-052 (private visibility) and BR-060 (only public collections can be followed). |

---

**TC-031**

| Field | Value |
|---|---|
| **ID** | TC-031 |
| **Title** | Concurrent add-to-collection from two browser tabs does not corrupt data |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-054 |
| **Precondition** | `registered_user_01` is authenticated in two browser tabs. Collection `collection_id_A` does NOT yet contain photo `photo_004`. |
| **Test Data** | `photo_id: photo_004` / `collection_id: collection_id_A` / two concurrent sessions (same user, Tab A and Tab B) |
| **Steps** | 1. Open Tab A: log in as `registered_user_01`, navigate to photo `photo_004` detail page, open the Collect dropdown. 2. Open Tab B: same user, same photo `photo_004` detail page, open the Collect dropdown. 3. In Tab A, click "Urban Life" to add the photo. 4. Immediately in Tab B, also click "Urban Life" to add the same photo before Tab A's response loads. |
| **Expected Result** | Photo `photo_004` is added to "Urban Life" exactly once. One of the requests succeeds; the other receives `"Already in this collection"` or is silently de-duplicated. The photo count in the collection increments by 1, not 2. No data corruption occurs. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Concurrent duplicate prevention for BR-054. |

---

**TC-032**

| Field | Value |
|---|---|
| **ID** | TC-032 |
| **Title** | Photo contributor does not receive duplicate notifications when the same photo is added to the same collection concurrently |
| **Type** | Edge Case |
| **Priority** | P3 - Medium |
| **Rule Ref** | BR-054, BR-055 |
| **Precondition** | `registered_user_01` is adding photo `photo_004` (owned by `contributor_user_01`) to collection `collection_id_A`. Concurrent duplicate-add scenario from TC-031 applies. |
| **Test Data** | Same as TC-031 |
| **Steps** | 1. Execute the concurrent-add scenario from TC-031 (two simultaneous add requests for photo `photo_004`). 2. Check the notifications received by `contributor_user_01` for photo `photo_004`. |
| **Expected Result** | `contributor_user_01` receives exactly 1 notification about photo `photo_004` being added to "Urban Life". No duplicate notifications are generated for the second (de-duplicated) add attempt. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Notification deduplication. [NOT SPECIFIED: spec does not describe notification deduplication logic â€” add to spec for precise behavior.] |

---

#### ðŸ”’ Security

---

**TC-033**

| Field | Value |
|---|---|
| **ID** | TC-033 |
| **Title** | IDOR: User cannot add a photo to another user's collection |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049 |
| **Precondition** | `registered_user_01` is authenticated. `registered_user_02` owns collection `collection_id_002`. |
| **Test Data** | `photo_id: photo_005` / `collection_id: collection_id_002` (belongs to `registered_user_02`) / auth token: for `registered_user_01` |
| **Steps** | 1. Log in as `registered_user_01` and obtain their auth token. 2. Send a POST request to the add-photo endpoint with `photo_id: photo_005` and `collection_id: collection_id_002` (collection belonging to `registered_user_02`) using `registered_user_01`'s auth token. 3. Observe the HTTP response. |
| **Expected Result** | Server returns HTTP `403 Forbidden` or `404 Not Found`. Photo `photo_005` is NOT added to `collection_id_002`. The response does not reveal that the collection belongs to another user (no account enumeration). |
| **Actual Result** | |
| **Status** | |
| **Notes** | Core IDOR test: collection_id ownership enforcement. |

---

**TC-034**

| Field | Value |
|---|---|
| **ID** | TC-034 |
| **Title** | SQL injection in photo_id parameter does not cause database errors |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-053 |
| **Precondition** | `registered_user_01` is authenticated. Collection `collection_id_A` exists. |
| **Test Data** | `photo_id: "'; DROP TABLE collections;--"` / `collection_id: collection_id_A` |
| **Steps** | 1. Log in as `registered_user_01` and obtain their auth token. 2. Send a POST request to the add-photo endpoint with `photo_id: "'; DROP TABLE collections;--"` and a valid `collection_id`. 3. Observe the HTTP response and verify database integrity. |
| **Expected Result** | Server returns HTTP `400 Bad Request` or `404 Not Found` with an error message. No SQL is executed. No database table is dropped. No stack trace is visible in the response. |
| **Actual Result** | |
| **Status** | |
| **Notes** | SQL injection via photo_id parameter. |

---

**TC-035**

| Field | Value |
|---|---|
| **ID** | TC-035 |
| **Title** | Unauthenticated POST to add-photo endpoint returns 401 |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049 |
| **Precondition** | No active session. Collection `collection_id_A` is a known public collection. |
| **Test Data** | `photo_id: photo_002` / `collection_id: collection_id_A` / Authorization: absent |
| **Steps** | 1. Without logging in, send a POST request to the add-photo-to-collection endpoint with `photo_id: photo_002` and `collection_id: collection_id_A` and no Authorization header. 2. Observe the HTTP response. |
| **Expected Result** | Server returns HTTP `401 Unauthorized`. Photo `photo_002` is NOT added to any collection. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

### Flow 3 â€” Delete a Collection

#### ðŸŸ¢ Happy Path

---

**TC-036**

| Field | Value |
|---|---|
| **ID** | TC-036 |
| **Title** | Authenticated user deletes their own collection â€” photos remain on Unsplash |
| **Type** | Happy Path |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-057 |
| **Precondition** | `registered_user_01` is authenticated and owns collection `collection_id_A` ("Urban Life") which contains photos `photo_001`, `photo_002`, `photo_003`. |
| **Test Data** | `collection_id: collection_id_A` ("Urban Life") / photos in collection: photo_001, photo_002, photo_003 |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to the profile page â†’ Collections tab. 3. Select collection "Urban Life". 4. Click the "Delete collection" button. 5. Observe the confirmation dialog. 6. Read the confirmation message. 7. Click "Confirm" (or equivalent "Delete" button in the dialog). |
| **Expected Result** | Confirmation dialog displays: `"Are you sure you want to delete Urban Life? This cannot be undone."` After confirmation: Collection "Urban Life" is permanently deleted. It no longer appears in `registered_user_01`'s Collections tab. Photos `photo_001`, `photo_002`, `photo_003` still exist on Unsplash and are accessible. No photos are deleted from the platform. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

**TC-037**

| Field | Value |
|---|---|
| **ID** | TC-037 |
| **Title** | User cancels collection deletion â€” collection is preserved |
| **Type** | Happy Path |
| **Priority** | P3 - Medium |
| **Rule Ref** | BR-057 |
| **Precondition** | `registered_user_01` is authenticated and owns collection `collection_id_A` ("Urban Life"). |
| **Test Data** | `collection_id: collection_id_A` ("Urban Life") |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to the profile page â†’ Collections tab. 3. Select collection "Urban Life". 4. Click the "Delete collection" button. 5. In the confirmation dialog, click "Cancel" (or the X/close button). |
| **Expected Result** | The confirmation dialog closes. Collection "Urban Life" is NOT deleted. It remains visible in `registered_user_01`'s Collections tab with all its photos intact. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Verifies the cancel action in the delete confirmation dialog. |

---

#### ðŸ”´ Negative

---

**TC-038**

| Field | Value |
|---|---|
| **ID** | TC-038 |
| **Title** | User cannot delete another user's collection |
| **Type** | Negative |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-057 |
| **Precondition** | `registered_user_01` is authenticated. `registered_user_02` owns collection `collection_id_002`. |
| **Test Data** | `collection_id: collection_id_002` (belongs to `registered_user_02`) / auth token: `registered_user_01` |
| **Steps** | 1. Log in as `registered_user_01` and obtain their auth token. 2. Send a DELETE request to the collection deletion endpoint with `collection_id: collection_id_002` using `registered_user_01`'s auth token. 3. Observe the HTTP response. |
| **Expected Result** | Server returns HTTP `403 Forbidden` or `404 Not Found`. Collection `collection_id_002` is NOT deleted. `registered_user_02`'s collection remains intact. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Ownership enforcement for deletion. |

---

**TC-039**

| Field | Value |
|---|---|
| **ID** | TC-039 |
| **Title** | Guest user cannot access the delete collection option |
| **Type** | Negative |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-049, BR-057 |
| **Precondition** | No user is logged in. A public collection URL `collection_id_A` is known. |
| **Test Data** | `collection_id: collection_id_A` / session: guest (unauthenticated) |
| **Steps** | 1. Without logging in, navigate to the public collection page for `collection_id_A`. 2. Observe the available UI options on the collection page. 3. Attempt to send a DELETE request directly to the delete endpoint with no auth token. |
| **Expected Result** | The "Delete collection" button is NOT visible in the UI for guest users. Direct DELETE API call returns HTTP `401 Unauthorized`. The collection is NOT deleted. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

#### ðŸŸ¡ Edge Cases

---

**TC-040**

| Field | Value |
|---|---|
| **ID** | TC-040 |
| **Title** | Deleting a collection followed by other users removes it from their following lists |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-057, BR-060 |
| **Precondition** | `registered_user_01` owns public collection `collection_id_A` ("Urban Life"). `registered_user_02` and `registered_user_03` are both following this collection. |
| **Test Data** | `collection_id: collection_id_A` / followers: registered_user_02, registered_user_03 |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to profile â†’ Collections tab. 3. Select "Urban Life" and click "Delete collection". 4. Confirm deletion in the dialog. 5. Log out and log in as `registered_user_02`. 6. Navigate to the Following Collections section of `registered_user_02`'s account. 7. Log out and log in as `registered_user_03`. 8. Navigate to the Following Collections section of `registered_user_03`'s account. |
| **Expected Result** | Collection "Urban Life" no longer appears in `registered_user_02`'s following list. Collection "Urban Life" no longer appears in `registered_user_03`'s following list. Accessing the collection's former URL returns 404. Photos from the collection remain on Unsplash. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

**TC-041**

| Field | Value |
|---|---|
| **ID** | TC-041 |
| **Title** | Deleting a collection that contains no photos succeeds |
| **Type** | Edge Case |
| **Priority** | P3 - Medium |
| **Rule Ref** | BR-057 |
| **Precondition** | `registered_user_01` is authenticated and owns an empty collection `collection_id_empty` ("Empty Album") with 0 photos. |
| **Test Data** | `collection_id: collection_id_empty` ("Empty Album") / photo count: 0 |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to profile â†’ Collections tab. 3. Select "Empty Album". 4. Click "Delete collection". 5. Confirm deletion in the dialog. |
| **Expected Result** | Collection "Empty Album" is deleted successfully. No error occurs due to the collection having zero photos. The collection no longer appears in the user's Collections tab. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Empty collection deletion edge case. |

---

#### ðŸ”’ Security

---

**TC-042**

| Field | Value |
|---|---|
| **ID** | TC-042 |
| **Title** | IDOR: Delete request with another user's collection ID returns 403 |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-057 |
| **Precondition** | `registered_user_01` is authenticated. `registered_user_02` owns collection `collection_id_002`. |
| **Test Data** | DELETE request to `/api/collections/collection_id_002` / auth token: `registered_user_01` |
| **Steps** | 1. Log in as `registered_user_01` and obtain auth token. 2. Send a DELETE request to `/api/collections/collection_id_002` (collection belonging to `registered_user_02`) using `registered_user_01`'s token. 3. Observe HTTP status code and response body. 4. Verify `collection_id_002` still exists in the database. |
| **Expected Result** | HTTP `403 Forbidden` or `404 Not Found` is returned. Collection `collection_id_002` is NOT deleted. Response body does not disclose that the collection exists or who owns it (prevents account enumeration). |
| **Actual Result** | |
| **Status** | |
| **Notes** | IDOR test specific to collection deletion. |

---

**TC-043**

| Field | Value |
|---|---|
| **ID** | TC-043 |
| **Title** | CSRF: Collection deletion requires valid CSRF token â€” forged request is rejected |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-057 |
| **Precondition** | `registered_user_01` is authenticated and owns collection `collection_id_A`. |
| **Test Data** | Forged cross-origin DELETE request to `/api/collections/collection_id_A` without CSRF token |
| **Steps** | 1. Log in as `registered_user_01` in Browser A. 2. From a different origin (local HTML file or Browser B), craft a DELETE request to `/api/collections/collection_id_A` without a valid CSRF token (using any available session cookie). 3. Submit the forged request. 4. Check whether collection `collection_id_A` still exists. |
| **Expected Result** | Server rejects the request with HTTP `403 Forbidden` or `Invalid CSRF token`. Collection `collection_id_A` is NOT deleted. |
| **Actual Result** | |
| **Status** | |
| **Notes** | CSRF on DELETE endpoint. |

---

### Flow 4 â€” Collection Display, Cover Photo & Reordering

> These test cases cover BR-058, BR-059 which are not directly tied to the three primary flows but are part of the feature scope.

#### ðŸŸ¢ Happy Path

---

**TC-044**

| Field | Value |
|---|---|
| **ID** | TC-044 |
| **Title** | First photo added to a collection is automatically set as the cover photo |
| **Type** | Happy Path |
| **Priority** | P2 - High |
| **Rule Ref** | BR-059 |
| **Precondition** | `registered_user_01` is authenticated. A new empty collection `collection_id_new` ("Fresh Collection") has just been created. |
| **Test Data** | `collection_id: collection_id_new` / `photo_id: photo_cover_001` (first photo to be added) |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to photo `photo_cover_001` detail page. 3. Click "Collect" and add `photo_cover_001` to "Fresh Collection". 4. Navigate to "Fresh Collection" page. 5. Observe the cover photo displayed. |
| **Expected Result** | `photo_cover_001` is displayed as the cover photo of "Fresh Collection". No manual cover photo selection was needed. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Default cover photo behavior per BR-059. |

---

**TC-045**

| Field | Value |
|---|---|
| **ID** | TC-045 |
| **Title** | User can change the cover photo to another photo already in the collection |
| **Type** | Happy Path |
| **Priority** | P2 - High |
| **Rule Ref** | BR-059 |
| **Precondition** | `registered_user_01` is authenticated. Collection `collection_id_A` contains `photo_001` (current cover) and `photo_002`. |
| **Test Data** | `collection_id: collection_id_A` / `new_cover_photo_id: photo_002` (already in collection) |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to collection `collection_id_A`. 3. Open the collection settings or right-click on `photo_002` in the collection. 4. Select "Set as cover photo". 5. Confirm the change. |
| **Expected Result** | The cover photo of `collection_id_A` changes to `photo_002`. `photo_001` remains in the collection but is no longer the cover. The updated cover photo is displayed on the collection page and in any listing views. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

**TC-046**

| Field | Value |
|---|---|
| **ID** | TC-046 |
| **Title** | User can reorder photos within a collection using drag-and-drop |
| **Type** | Happy Path |
| **Priority** | P2 - High |
| **Rule Ref** | BR-058 |
| **Precondition** | `registered_user_01` is authenticated. Collection `collection_id_A` contains photos in order: [photo_001, photo_002, photo_003]. |
| **Test Data** | `collection_id: collection_id_A` / initial order: [photo_001, photo_002, photo_003] / desired new order: [photo_003, photo_001, photo_002] |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to collection `collection_id_A`. 3. Drag `photo_003` from position 3 to position 1 (before photo_001). 4. Release the drag to confirm new position. 5. Refresh the page. |
| **Expected Result** | The collection displays photos in the new order: [photo_003, photo_001, photo_002]. After page refresh, the new order persists. No photos are removed or duplicated. |
| **Actual Result** | |
| **Status** | |
| **Notes** | |

---

#### ðŸ”´ Negative

---

**TC-047**

| Field | Value |
|---|---|
| **ID** | TC-047 |
| **Title** | Setting a cover photo to a photo NOT in the collection is blocked |
| **Type** | Negative |
| **Priority** | P2 - High |
| **Rule Ref** | BR-059 |
| **Precondition** | `registered_user_01` is authenticated. Collection `collection_id_A` contains [photo_001, photo_002]. Photo `photo_external_001` exists on Unsplash but is NOT in `collection_id_A`. |
| **Test Data** | `collection_id: collection_id_A` / `photo_id: photo_external_001` (not in collection) |
| **Steps** | 1. Log in as `registered_user_01` and obtain auth token. 2. Send a PATCH/PUT request to the collection update endpoint with `cover_photo_id: photo_external_001` for collection `collection_id_A`. 3. Observe the HTTP response. |
| **Expected Result** | Server returns HTTP `400 Bad Request` or `422 Unprocessable Entity`. Error message states that only photos already in the collection can be set as the cover. The cover photo of `collection_id_A` remains unchanged as the previous cover. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Edge case from spec: "Blocked; only photos already in the collection can be set as cover." |

---

#### ðŸŸ¡ Edge Cases

---

**TC-048**

| Field | Value |
|---|---|
| **ID** | TC-048 |
| **Title** | Reordering photos with drag-and-drop during a concurrent session â€” last save wins without data corruption |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-058 |
| **Precondition** | `registered_user_01` has collection `collection_id_A` with photos [photo_001, photo_002, photo_003] open in two browser tabs simultaneously. |
| **Test Data** | Tab A desired order: [photo_003, photo_001, photo_002] / Tab B desired order: [photo_002, photo_003, photo_001] |
| **Steps** | 1. Open Tab A: log in as `registered_user_01`, navigate to `collection_id_A`. 2. Open Tab B: same user, same collection. 3. In Tab A, drag `photo_003` to position 1 â†’ wait for the drag-ghost to be in place but do NOT release yet. 4. In Tab B, drag `photo_002` to position 1 and release (save Tab B's order). 5. Release Tab A's drag (save Tab A's order). 6. Refresh both tabs. |
| **Expected Result** | The collection's final saved photo order is the one from the last write (Tab A's order: [photo_003, photo_001, photo_002]). No photos are lost from the collection. No data corruption (no duplicate entries, no missing photos). After refresh, both tabs display the same consistent order. |
| **Actual Result** | |
| **Status** | |
| **Notes** | Spec explicitly states: "Last save wins; no data corruption." |

---

**TC-049**

| Field | Value |
|---|---|
| **ID** | TC-049 |
| **Title** | Cover photo is preserved when another photo in the collection is removed |
| **Type** | Edge Case |
| **Priority** | P3 - Medium |
| **Rule Ref** | BR-059 |
| **Precondition** | `registered_user_01` owns collection `collection_id_A` with [photo_001 (cover), photo_002, photo_003]. |
| **Test Data** | Remove `photo_002` (not the cover) from collection `collection_id_A` |
| **Steps** | 1. Log in as `registered_user_01`. 2. Navigate to collection `collection_id_A`. 3. Remove `photo_002` from the collection (not the cover photo). 4. Navigate back to the collection page. |
| **Expected Result** | `photo_001` remains as the cover photo. The collection now displays [photo_001, photo_003]. No cover photo reset occurs. |
| **Actual Result** | |
| **Status** | |
| **Notes** | [VERIFY: confirm behavior when the cover photo itself is removed â€” spec does not describe this scenario.] |

---

### Flow 5 â€” Admin Moderation & Private Collection Access

> These test cases cover BR-056 (admin content removal) and private URL access control.

#### ðŸŸ¡ Edge Cases

---

**TC-050**

| Field | Value |
|---|---|
| **ID** | TC-050 |
| **Title** | Private collection URL accessed by another authenticated user returns 404 or access denied |
| **Type** | Edge Case |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-052 |
| **Precondition** | `registered_user_01` owns private collection `collection_id_priv` ("Private Favorites"). `registered_user_02` is authenticated but is NOT the owner. |
| **Test Data** | Collection URL: `/collections/collection_id_priv` / accessing user: `registered_user_02` |
| **Steps** | 1. Log in as `registered_user_02`. 2. Navigate directly to the URL of `registered_user_01`'s private collection: `/collections/collection_id_priv`. 3. Observe the HTTP response and page content. |
| **Expected Result** | The page returns HTTP `404 Not Found` or `403 Access Denied`. The collection contents (photos, name, metadata) are NOT visible to `registered_user_02`. The response does NOT reveal that the collection exists (no "You don't have access" message that would confirm existence). |
| **Actual Result** | |
| **Status** | |
| **Notes** | Privacy enforcement for private collections per BR-052. |

---

**TC-051**

| Field | Value |
|---|---|
| **ID** | TC-051 |
| **Title** | Admin removes a collection with offensive content â€” creator receives email notification |
| **Type** | Edge Case |
| **Priority** | P2 - High |
| **Rule Ref** | BR-056 |
| **Precondition** | An admin account `admin_user_01` exists. `registered_user_01` owns collection `collection_id_offensive` ("Offensive Content Test") containing content flagged as violating guidelines. The admin has tools to remove collections. |
| **Test Data** | `collection_id: collection_id_offensive` / admin: `admin_user_01` / creator: `registered_user_01` |
| **Steps** | 1. Log in as `admin_user_01`. 2. Navigate to the admin dashboard. 3. Locate collection `collection_id_offensive` in the moderation queue. 4. Click "Remove collection" or equivalent admin action. 5. Confirm the removal. 6. Check the inbox of `registered_user_01` for an email notification. |
| **Expected Result** | Collection `collection_id_offensive` is removed from Unsplash. The collection no longer appears in `registered_user_01`'s profile or public search. `registered_user_01` receives an email notifying them that their collection was removed for violating content guidelines. [VERIFY: confirm exact email subject, body, and sender per BR-056.] Photos within the collection remain on Unsplash unless separately moderated. |
| **Actual Result** | |
| **Status** | |
| **Notes** | [NOT SPECIFIED: email content and timing are not described in the spec. Add exact email template to spec for testability.] |

---

#### ðŸ”’ Security

---

**TC-052**

| Field | Value |
|---|---|
| **ID** | TC-052 |
| **Title** | Private collection metadata not exposed via API for non-owners |
| **Type** | Security |
| **Priority** | P1 - Critical |
| **Rule Ref** | BR-052 |
| **Precondition** | `registered_user_01` owns private collection `collection_id_priv`. `registered_user_02` is authenticated. |
| **Test Data** | GET request to `/api/collections/collection_id_priv` / auth token: `registered_user_02` |
| **Steps** | 1. Log in as `registered_user_02` and obtain their auth token. 2. Send a GET request to `/api/collections/collection_id_priv` using `registered_user_02`'s auth token. 3. Inspect the HTTP status code, response headers, and response body. |
| **Expected Result** | Server returns HTTP `404 Not Found` or `403 Forbidden`. The response body does NOT contain any collection metadata (name, photo count, photo IDs, owner information). No information leakage about the private collection's existence. |
| **Actual Result** | |
| **Status** | |
| **Notes** | API-level information disclosure test for private collection. Combined with TC-050 (UI-level test). |

---

## Traceability Matrix

| Rule ID | Rule Description | Covered By | Status |
|---|---|---|---|
| BR-049 | Only authenticated users can create collections | TC-001, TC-002, TC-003, TC-005, TC-015, TC-017, TC-019, TC-020, TC-021, TC-027, TC-035, TC-038, TC-039 | Covered |
| BR-050 | A user can create an unlimited number of collections | TC-004 | Covered |
| BR-051 | Collection names must be between 1 and 60 characters | TC-006, TC-007, TC-008, TC-010, TC-011, TC-012, TC-013, TC-014, TC-016, TC-017, TC-018, TC-022 | Covered |
| BR-052 | Collections can be Public or Private (visibility control) | TC-001, TC-002, TC-003, TC-009, TC-018, TC-029, TC-030, TC-050, TC-052 | Covered |
| BR-053 | Users can add any photo (free or Unsplash+) without a subscription | TC-023, TC-025, TC-028, TC-034 | Covered |
| BR-054 | A user cannot add the same photo to the same collection twice | TC-024, TC-026, TC-031, TC-032 | Covered |
| BR-055 | Photo contributor notified when their photo is added to a collection | TC-023, TC-032 | Covered |
| BR-056 | Admin removes offensive collections; email sent to creator | TC-051 | Covered |
| BR-057 | Users can delete their collections; photos remain on Unsplash | TC-036, TC-037, TC-038, TC-039, TC-040, TC-041, TC-042, TC-043 | Covered |
| BR-058 | Users can reorder photos within a collection | TC-046, TC-048 | Covered |
| BR-059 | Cover photo defaults to first photo; user can change it | TC-002, TC-044, TC-045, TC-047, TC-049 | Covered |
| BR-060 | Other users can follow public collections | TC-029, TC-030, TC-040 | Covered |

---

## Coverage Summary

| Type | Count |
|---|---|
| Happy Path | 13 |
| Negative | 10 |
| Edge Case | 16 |
| Security | 13 |
| **Total** | **52** |

**Rule Coverage:** 12 / 12 rules covered (100%)

**TC Coverage by Flow:**

| Flow | TC Range | Count |
|---|---|---|
| Flow 1 â€” Create a New Collection | TC-001 to TC-022 | 22 |
| Flow 2 â€” Add Photo to Existing Collection | TC-023 to TC-035 | 13 |
| Flow 3 â€” Delete a Collection | TC-036 to TC-043 | 8 |
| Flow 4 â€” Cover Photo & Reordering | TC-044 to TC-049 | 6 |
| Flow 5 â€” Admin Moderation & Private Access | TC-050 to TC-052 | 3 |

**Coverage Gaps:** None â€” all 12 business rules (BR-049 to BR-060) are covered by at least one test case.

**Orphaned TCs:** None â€” every TC has a rule_ref.

---

## Spec Gap Warnings

> The following warnings are issued for non-blocking spec gaps found during Intelligence Scan. These do NOT stop TC generation but affect the completeness of affected TCs.

```
âš ï¸ WARN-002 (partial): SPEC GAP DETECTED

Gap type: External dependency behavior not fully specified
Affected TC types: Happy Path, Edge Case
Impact: BR-055 (contributor notification) and BR-056 (admin email to creator) do not specify
        the notification message content, delivery channel, or timing.
        Affected TCs (TC-023, TC-032, TC-051) use [VERIFY] and [NOT SPECIFIED] markers in
        expected results and notes.
Recommendation: Add to the spec:
  - BR-055: "Notification message: 'Your photo [title] was saved to [collection name] by [username]' â€”
    delivered via in-app notification within 60 seconds."
  - BR-056: "Email subject: 'Your collection [name] was removed' â€” sent within 5 minutes of admin action."
TCs affected: TC-023, TC-032, TC-051 (marked needs_review for notification content verification)
```

---

## Anti-Pattern Guard â€” Self-Check Results

All 52 test cases passed the Anti-Pattern Guard check:

| Check | Result |
|---|---|
| Vague steps ("enter valid information") | 0 violations |
| Unverifiable expected results ("should work correctly") | 0 violations |
| Missing test data | 0 violations |
| Duplicate scenarios | 0 violations |
| Missing rule_ref | 0 violations |
| Security case with no exploit vector | 0 violations |

**TCs marked needs_review (for spec gap â€” external dependency):** TC-023, TC-032, TC-051

```
âš ï¸ QC REVIEW REQUIRED
The following test cases were flagged due to underspecified external dependencies in the spec.
All other fields are complete and executable:
- TC-023: [NOT SPECIFIED] â€” notification content and channel for BR-055 not defined in spec
- TC-032: [NOT SPECIFIED] â€” notification deduplication behavior not defined in spec
- TC-051: [VERIFY] â€” exact email content for admin removal notification (BR-056) not defined in spec
Please verify expected notification/email behavior with the development team before executing these TCs.
```

---

## Test Execution Report

- **Feature:** Collections Management (Feature 6)
- **Tester:** ___________
- **Date:** ___________
- **Environment:** ___________
- **Build / Version:** ___________

### Summary

| Total TCs | Pass | Fail | Blocked | Not Run |
|---|---|---|---|---|
| 52 | | | | |

### Defects Found

| Bug ID | TC ID | Rule Ref | Description | Severity | Status |
|---|---|---|---|---|---|
| | | | | | |

### Sign-off

- [ ] QC Lead Review: ___________
- [ ] Security Review (if applicable): ___________
- [ ] Ready for Release
